common_install_docker: True
docker_install: False
mysql_docker: True

docker_applications: [phpmyadmin]

nginx_appname: "redmine"
nginx_vhost_mode: "reverse"
nginx_reverse_proxy_port: "9007"
nginx_certbot: True

mysql_databases:
 - name: redmine
 
mysql_users:
 - name: redmine
   priv: 'redmine.*:ALL'

init_docker:
  mysql:
    db: mysql
    db_name: redmine
    db_username: root
    db_password: "123456"
    service_after: "docker.service"
    compose_path: "/data/db/mysql{{mysql_version}}/docker-compose.yml"
    compose_commands:
      - sudo sed -i "s/123456/$new_password/g" /data/db/mysql{{mysql_version}}/docker-compose.yml
    volumes:
      - /data/db/mysql{{mysql_version}}/data

init_docker:
  redmine:
    db: mysql
    db_username: redmine
    db_name: redmine
    db_password: "123456" 
    admin_username: admin
    admin_password: "admin"
    service_after: "docker.service"
    compose_path: "/data/wwwroot/redmine/docker-compose.yml"
    compose_commands:
      - sudo sed -i "s/123456/$new_password/g" /data/wwwroot/redmine/docker-compose.yml
    volumes:
      - /data/redmine
    commands: 
      - sudo docker exec -it mysql-redmine bash -c 'bash /tmp/init_password.sh'
      - sudo docker restart redmine
      - sudo systemctl restart nginx


