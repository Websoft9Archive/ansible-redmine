common_install_docker: True
docker_install: False

mysql_version: "5.7"
mysql_docker: True

docker_applications: [phpmyadmin]

nginx_appname: "redmine"
nginx_vhost_mode: "reverse"
nginx_reverse_proxy_port: "9007"
nginx_certbot: True

mysql_databases:
 - name: redmine
 
mysql_users:
 - name: redmine
   priv: 'redmine.*:ALL'


init_db: 
  mysql:
    admin: root
    users: ["redmine"]
    password: "123456"  
    config_paths:
      - sudo sed -i "s/123456/$new_password/g" /data/db/mysql{{mysql_version}}/docker-compose.yml
      - sudo sed -i "s/123456/$new_password/g" /data/wwwroot/redmine/docker-compose.yml

init_docker:
  redmine:
    admin_username: admin
    admin_password: "admin"
    service_after: "docker.service"
    compose_path: "/data/wwwroot/redmine/docker-compose.yml"
    compose_commands:
      - sudo docker-compose -f /data/db/mysql{{mysql_version}}/docker-compose.yml up -d
      - sudo docker cp /data/wwwroot/redmine/init_password.sh   mysql{{mysql_version}}:/tmp/init_password.sh
      - sudo docker exec -it mysql{{mysql_version}} bash -c 'bash /tmp/init_password.sh'
    volumes:
      - /data/redmine




